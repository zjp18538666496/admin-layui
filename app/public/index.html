<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Pear Admin Layui</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  </head>
  <link rel="stylesheet" type="text/css" href="./component/layui/css/layui.css" />
  <link rel="stylesheet" type="text/css" href="component/css/index.css" />
  <link rel="stylesheet" type="text/css" href="component/css/common.css" />
  <script src="./component/layui/layui.js" type="text/javascript" charset="utf-8"></script>
  <script src="./component/layer/layer.js" type="text/javascript" charset="utf-8"></script>
  <script src="./component/jquery/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
  <style>
    html,
    body,
    iframe {
      width: 100%;
      height: 100%;
    }
  </style>
  <body style="background-color: #F5F5F5;">
    <div>
      <!-- 侧边栏开始 -->
      <div class="sidebar left layui-side">
        <ul class="layui-nav layui-nav-tree menu">
          <li class="w-230 layui-font-blue layui-font-21 layui-nav-item">Pear Admin</li>
          <li class="layui-nav-item w-230 h-59">
            <a href="javascript:;" class="h-59"><i class="layui-icon layui-icon-console">&nbsp;&nbsp;</i>工作空间</a>
            <dl class="layui-nav-child">
              <dd><a href="javascript:;" lay-id="1" data-url="view/work/bac-data.html">控制后台</a></dd>
              <dd><a href="javascript:;" lay-id="2" data-url="view/work/analysis.html">数据分析</a></dd>
              <dd><a href="javascript:;" lay-id="3" data-url="https://cn.bing.com/">百度一下</a></dd>
              <dd><a href="javascript:;" lay-id="4">主题预览</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item w-230 h-59">
            <a href="javascript:;"><i class="layui-icon layui-icon-component">&nbsp;&nbsp;</i>常用组件</a>
            <dl class="layui-nav-child">
              <dd><a href="javascript:;" lay-id="5">基础组件</a></dd>
              <dd><a href="javascript:;" lay-id="6">进阶组件</a></dd>
              <dd><a href="javascript:;" lay-id="7">弹层组件</a></dd>
              <dd><a href="javascript:;" lay-id="8">高级组件</a></dd>
              <dd><a href="javascript:;" lay-id="9">其他组件</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item w-230 h-59">
            <a href="javascript:;"><i class="layui-icon layui-icon-auz">&nbsp;&nbsp;</i>结果页面</a>
            <dl class="layui-nav-child">
              <dd><a href="javascript:;" lay-id="10">成功</a></dd>
              <dd><a href="javascript:;" lay-id="11">失败</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item w-230 h-59">
            <a href="javascript:;"><i class="layui-icon layui-icon-face-cry">&nbsp;&nbsp;</i>错误页面</a>
            <dl class="layui-nav-child">
              <dd><a href="javascript:;" lay-id="12">403</a></dd>
              <dd><a href="javascript:;" lay-id="13">404</a></dd>
              <dd><a href="javascript:;" lay-id="14">500</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item w-230 h-59">
            <a href="javascript:;"><i class="layui-icon layui-icon-set-fill">&nbsp;&nbsp;</i>系统管理</a>
            <dl class="layui-nav-child">
              <dd><a href="javascript:;" lay-id="14" data-url="view/system/user.html">用户管理</a></dd>
              <dd><a href="javascript:;" lay-id="15" data-url="view/system/role.html">角色管理</a></dd>
              <dd><a href="javascript:;" lay-id="16" data-url="view/system/permission.html">权限管理</a></dd>
              <dd><a href="javascript:;" lay-id="17" data-url="view/system/manag.html">部门管理</a></dd>
              <dd><a href="javascript:;" lay-id="18" data-url="view/system/behavior.html">行为日志</a></dd>
              <dd><a href="javascript:;" lay-id="19" data-url="view/system/dd.html">数据字典</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item w-230 h-59">
            <a href="javascript:;"><i class="layui-icon layui-icon-template-1">&nbsp;&nbsp;</i>常用页面</a>
            <dl class="layui-nav-child">
              <dd><a href="javascript:;" lay-id="20" data-url="login.html">登录页面</a></dd>
              <dd><a href="javascript:;" lay-id="21">空白页面</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item w-230 h-59">
            <a href="javascript:;"><i class="layui-icon layui-icon-chart">&nbsp;&nbsp;</i>工作空间</a>
            <dl class="layui-nav-child">
              <dd><a href="javascript:;" lay-id="22">折线图</a></dd>
              <dd><a href="javascript:;" lay-id="23">柱状图</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item w-230 h-59">
            <a href="javascript:;"><i class="layui-icon layui-icon-util">&nbsp;&nbsp;</i>开发工具</a>
            <dl class="layui-nav-child">
              <dd><a href="javascript:;" lay-id="24">表单构建</a></dd>
            </dl>
          </li>
        </ul>
      </div>

      <!-- 导航栏开始 -->
      <div class="s1 white">
        <!-- 左导航栏 -->
        <div>
          <ul class="layui-nav white l-menu">
            <li class="layui-nav-item">
              <a href=""><span class="layui-icon layui-icon-shrink-right"
                  style="color: black;font-size: 15px;"></span></a>
            </li>
            <li class="layui-nav-item">
              <a href=""><span class="layui-icon layui-icon-refresh-1" style="color: black;font-size: 15px;"></span></a>
            </li>
          </ul>
        </div>
        <!-- 右导航栏 -->
        <div>
          <ul class="layui-nav right white clearfix">
            <li class="layui-nav-item">
              <!-- <span class="layui-icon layui-icon-screen-full" style="color: black;font-size: 15px; padding: 0 20px;"
                onclick="handleFullScreen()" id="demo"></span> -->
              <span class="layui-icon layui-icon-screen-full" style="color: black;font-size: 15px; padding: 0 20px;"
                onclick="fullScreen()"></span>
            </li>
            <li class="layui-nav-item">
              <a href=""><span data-toggle="fullscreen" class="layui-icon layui-icon-website"
                  style="color: black;font-size: 15px;"></span></a>
            </li>
            <li class="layui-nav-item">
              <a href=""><span class="layui-icon layui-icon-notice" style="color: black;font-size: 15px;"></span></a>
            </li>
            <li class="layui-nav-item">
              <a href=""><span class="layui-icon layui-icon-username" style="color: black;font-size: 15px;"></span></a>
            </li>
            <li class="layui-nav-item">
              <a href=""><span class="layui-icon layui-icon-more-vertical"
                  style="color: black;font-size: 15px;"></span></a>
            </li>
          </ul>
        </div>
      </div>
      <!-- 内容主体区域 -->
      <div style="padding: 10px;" class="win1 win2">
        <div class="layui-tab" lay-filter="test" lay-allowClose="true">
          <ul class="layui-tab-title bar white">
            <li class="layui-this" lay-id="0">首页</li>
          </ul>
          <div class="layui-tab-content pop">
            <div class="layui-tab-item layui-show">
              <iframe src="view/work/bac-data.html" style="border: 0;" class="innerbox"></iframe>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
<script>
  layui.use(['element', ], function() {
    var $ = layui.jquery,
      element = layui.element;
    /**
     * 打开页面iframe
     * @param {Object} id 
     * @param {Object} title
     * @param {Object} url
     * @param {Object} width
     * @param {Object} height
     */
    function open(id, title, url, width, height) {
      if (isEmpty(width)) {
        width = "100%"
      }
      if (isEmpty(height)) {
        width = "100%"
      }
      element.tabAdd('test', {
        title: title,
        content: "<iframe frameborder='0' width='" + width + "' height='" + height + "' src='" + url +
          "'></iframe>",
        id: id
      });
    }

    /**
     * 验证变量是否未空
     * @param {Object} val
     */
    function isEmpty(val) {
      return val == null || val == '' || typeof(val) == "undefined"
    }

    /**
     *  依据id关闭菜单tab,并更新菜单缓存
     * @param {Object} id
     */
    function closeMenu(id) {
      var openMenusStr = sessionStorage.getItem('openMenus'); //获取字段
      if (isEmpty(openMenusStr)) { //判断获取到的字段是否为空
        openMenusStr = "[]";
      }
      var openMenus = JSON.parse(openMenusStr) //转换为js对象
      var filterArr = openMenus.filter(function(f) {
        return f.id != id;
      });
      sessionStorage.setItem('openMenus', JSON.stringify(filterArr))
    }
    /**
     * 打开菜单
     * @param {Object} elem
     */
    function openMenu(id, title, url, isAdd = true) {
      var openMenusStr = sessionStorage.getItem('openMenus'); //获取字段
      if (isEmpty(openMenusStr)) { //判断获取到的字段是否为空
        openMenusStr = "[]";
      }
      var openMenus = JSON.parse(openMenusStr) //转换为js对象
      var filterArr = openMenus.filter(function(f) {
        return f.id == id;
      });
      if (filterArr.length > 0 && isAdd) {
        element.tabChange('test', id);
        return;
      }
      var menu = {
        id: id,
        title: title,
        url: url
      };
      openMenus.push(menu);
      if (isAdd) {
        sessionStorage.setItem('openMenus', JSON.stringify(openMenus)) // 存储字段 转换为json字符串
      }
      open(id, title, url);
      resize();
      element.tabChange('test', id);

    }
    /**
     * 页面初始化函数
     */
    function init() {
      var openMenusStr = sessionStorage.getItem('openMenus');
      if (isEmpty(openMenusStr)) {
        openMenusStr = "[]";
      }
      var openMenus = JSON.parse(openMenusStr)
      $.each(openMenus, function(i, v) {
        openMenu(v.id, v.title, v.url, false);
      })
    }
    //页面加载调用
    init();
    /**
     * 菜单打开事件
     */
    $(document).on('click', '.menu a[lay-id]', function() {
      var id = $(this).attr("lay-id");
      var title = $(this).text();
      var url = $(this).attr("data-url");
      openMenu(id, title, url);
    })
    /**
     * 菜单关闭事件
     */
    element.on('tabDelete(test)', function(data) {
      var id = $(this).parent().attr('lay-id');
      closeMenu(id);
    });


    function resize() {
      var $content = $(".layui-tab-content");
      $content.height($(this).height() - 114);
      $content.find('iframe').each(function() {
        $(this).height($content.height());
        $(this).width("100%")
      })
    }
    $(window).on('resize', function() {
      var $content = $(".layui-tab-content");
      $content.height($(this).height() - 114);
      $content.find('iframe').each(function() {
        $(this).height($content.height());
        $(this).width("100%")
      });
    });
    $(window).on('load', function() {
      var $content = $(".layui-tab-content");
      $content.height($(this).height() - 114);
      $content.find('iframe').each(function() {
        $(this).height($content.height());
        $(this).width("100%")
      });
    })
  });
  
  
  // 点击全屏事件
  //定义一个变量进行判断，默认false 非全屏状态
  var exitFullscreen = false;
  var fullScreenStatus = false;
  // 全屏事件
  function handleFullScreen() {
    var element = document.documentElement;
    if (this.fullscreen) {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.webkitCancelFullScreen) {
        document.webkitCancelFullScreen();
      } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
      } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
      }
    } else {
      if (element.requestFullscreen) {
        element.requestFullscreen();
      } else if (element.webkitRequestFullScreen) {
        element.webkitRequestFullScreen();
      } else if (element.mozRequestFullScreen) {
        element.mozRequestFullScreen();
      } else if (element.msRequestFullscreen) {
        // IE11
        element.msRequestFullscreen();
      }
    }
  }

  function fullScreen() {
    if (fullScreenStatus) {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
      } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
      } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
      }
    } else {
      handleFullScreen();
    }
    fullScreenStatus = !fullScreenStatus;
  }
  //监听window是否全屏，并进行相应的操作,支持esc键退出
  window.onresize = function() {
    var isFull = !!(document.webkitIsFullScreen || document.mozFullScreen ||
      document.msFullscreenElement || document.fullscreenElement
    ); //!document.webkitIsFullScreen都为true。因此用!!
    if (isFull == false) {
      $("#exitFullScreen").css("display", "none");
      $("#fullScreen").css("display", "");
    } else {
      $("#exitFullScreen").css("display", "");
      $("#fullScreen").css("display", "none");
    }

  }
</script>
